<!DOCTYPE html>
<html lang="en">
<head>
  <!--
    ‚ö†Ô∏è SECURITY WARNING - DEMO FILE ONLY ‚ö†Ô∏è

    This is a TEST/DEMO file for local development only.
    DO NOT use this code in production environments.

    Security Issues in This Demo:
    - Hardcoded localhost URLs (won't work in production)
    - Weak origin validation (security risk)
    - No CSRF protection
    - Not suitable for customer-facing websites

    For Production Embed Code:
    1. Log into your admin dashboard
    2. Navigate to Checkout Forms
    3. Click "Get Embed Code" on your form
    4. Copy the secure, production-ready embed code provided
    5. The production code includes proper origin validation

    This file is for testing the embed functionality during development.
  -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‚ö†Ô∏è DEMO ONLY - Checkout Form Embed Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .container {
      background: white;
      border-radius: 12px;
      padding: 40px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    }

    h1 {
      color: #1a202c;
      margin-bottom: 10px;
    }

    p {
      color: #4a5568;
      margin-bottom: 30px;
    }

    .embed-container {
      background: #f7fafc;
      border: 2px dashed #cbd5e0;
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
    }

    .info-box {
      background: #ebf8ff;
      border-left: 4px solid #3182ce;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 4px;
    }

    .info-box p {
      margin: 0;
      color: #2c5282;
      font-size: 14px;
    }

    .status {
      margin-top: 20px;
      padding: 15px;
      background: #f0fff4;
      border: 1px solid #9ae6b4;
      border-radius: 6px;
      color: #22543d;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <!-- Security Warning Banner -->
  <div style="background: #fed7d7; border: 2px solid #fc8181; border-radius: 8px; padding: 20px; margin-bottom: 20px; text-align: center;">
    <h2 style="color: #742a2a; margin: 0 0 10px 0;">‚ö†Ô∏è DEMO FILE - NOT FOR PRODUCTION USE</h2>
    <p style="color: #742a2a; margin: 0; font-size: 14px;">
      This is a test file for local development only. For production embed code,
      use the "Get Embed Code" feature in your admin dashboard.
    </p>
  </div>

  <div class="container">
    <h1>üõçÔ∏è Checkout Form Embedding Test</h1>
    <p>This page demonstrates embedding a checkout form from your e-commerce admin dashboard.</p>

    <div class="info-box">
      <p><strong>Testing Instructions:</strong></p>
      <p>1. Make sure your frontend dev server is running (npm run dev)</p>
      <p>2. Create a checkout form in the admin dashboard</p>
      <p>3. Copy the iframe code from the "Get Embed Code" button</p>
      <p>4. Replace the iframe below with your copied code</p>
      <p>5. Open this HTML file in your browser</p>
    </div>

    <div class="embed-container">
      <h3 style="margin-top: 0; color: #2d3748;">Embedded Checkout Form:</h3>

      <!-- Replace this iframe with your actual embed code -->
      <div id="checkout-form-placeholder"></div>
      <script>
        // Example: Auto-resize iframe embed (Method 2 from EmbedCodeModal)
        // Replace 'your-form-slug' with your actual form slug
        (function() {
          var iframe = document.createElement('iframe');
          iframe.src = 'http://localhost:5173/order/your-form-slug';
          iframe.style.width = '100%';
          iframe.style.height = '800px';
          iframe.style.border = 'none';
          iframe.style.maxWidth = '600px';
          iframe.style.margin = '0 auto';
          iframe.style.display = 'block';
          iframe.setAttribute('scrolling', 'auto');
          iframe.setAttribute('allowtransparency', 'true');

          // Auto-resize support
          // ‚ö†Ô∏è SECURITY NOTE: In production, replace with your actual domain
          window.addEventListener('message', function(e) {
            // TODO: Replace with your actual production domain
            var allowedOrigins = [
              'http://localhost:5173',  // Development only
              // 'https://yourdomain.com'  // Add your production domain here
            ];

            // Validate origin and message structure
            if (allowedOrigins.indexOf(e.origin) !== -1 &&
                e.data &&
                e.data.type === 'checkout-resize' &&
                typeof e.data.height === 'number') {
              iframe.style.height = e.data.height + 'px';
              updateStatus('Auto-resized to: ' + e.data.height + 'px');
            } else if (e.data && e.data.type === 'checkout-resize') {
              console.warn('Rejected postMessage from untrusted origin:', e.origin);
            }
          });

          document.getElementById('checkout-form-placeholder').appendChild(iframe);
        })();

        function updateStatus(message) {
          var statusDiv = document.getElementById('status');
          if (statusDiv) {
            statusDiv.innerHTML += '<br>‚úì ' + message;
          }
        }
      </script>

      <div id="status" class="status">
        <strong>Auto-Resize Status:</strong><br>
        Waiting for iframe to load...
      </div>
    </div>

    <div style="margin-top: 30px; padding: 20px; background: #fffaf0; border: 1px solid #feb2b2; border-radius: 6px;">
      <p style="margin: 0; color: #7c2d12; font-size: 14px;">
        <strong>‚ö†Ô∏è Important:</strong> Replace <code>your-form-slug</code> in the JavaScript code above with your actual checkout form slug. You can find the slug in your admin dashboard when creating/editing a form.
      </p>
    </div>
  </div>
</body>
</html>
